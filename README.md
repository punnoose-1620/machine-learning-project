# Machine Learning Project
Electricity Price Prediction for the Habo Plast firm as a part of our Machine Learning Project

![Generated Image](./display-image.webp)

# [Data Miner](./dataMiner.py)
This file contains all functions to mine live and historical data for [Energy Exported to Germany](https://www.energy-charts.info/charts/power/data/de/year_tcs_saldo_2025.json) and live and historical data for [Electricity Prices in the Stockholm(S3)](https://thingler.io/day-ahead?date=2025-02-12&bz=BZN|SE1,BZN|SE2,BZN|SE3,BZN|SE4) region of Sweden. 
The file also has functions to write these data to files based on the fetching parameters such as date and year.
The miner functions usually save data as each individual year and stations. Mined data for electricity export is also saved as a different file.

# [Data Merger](./dataMerger.py)
This file contains functions to merge datas from different sources, like merginf data across different years, different stations, different parameters, merging electricity export data and so on.
The data merged from all sources is finally saved to [`final_combined.csv`](./final_combined.csv)

# [Data Visualisation](./dataVisualisation.py)
This file contains all functions to plot graphs. This includes graphs for two different purposes
- graphs for datas related to mined data analysis
- graphs for model history
- graphs for model evaluations
- graphs for Actual vs Predicted models

# [Model Functions](./modelFunctions.py)
This file contains all functions for model creation and training.
We use the following models: 
- Polynomial Regression (Ridge)
- ANN Regression
- Random Forest Regression
- XGBoost Regression

We use the following Cross Validators:
- KFold
- GridSearchCV
- RandomizedScaledCV

*NOTE* : We use the MinMaxScaler to scale the values for some of the models.

# [Trainer](./trainer.py)

This file contains Hyper Parameters and invokes each model trainer function from [`modelFunctions.py](./modelFunctions.py).
Different function invokations can be commented to run each model individually. A good example would be:
`python trainer.py > ./ModelLogs/AnnTrainingLog.txt`
being used to log training results of ANN after commenting all other invokations on the [`trainer.py`](./trainer.py) file.

To train all the models at once, you can run this function using the code:
`python trainer.py > ./ModelLogs/TrainingResults.txt`

# [Tester](./tester.py)
This file is used to test the saved XGBoost Model but can be altered to test other model when saved.
This file works as follows:
- Loads the final data
- Separates the last 7 days of entries from the loaded data
- Processed the 7 days of data as necessary
- Loads the saved model from [ResultModels](./ResultModels/) folder
- Predicts for processed values using loaded model
- Calculates MAE, MSE and R2 values for the predicted data
- Also calculates mean difference between values, maximum difference between values and minimum difference between values.
- Plots graph for Actual vs Predicted using the functions coded in [`dataVisualisation.py`](./dataVisualisation.py)

# File Architecture
<pre><code>'''
├──documents/
|       └──Presentation Final.pptx : Presentation for the project
|       └──Report Final.pdf        : Report for the project
|
├──electricity/
|       └──SE`n`_`yyyy`_entsoe.csv : Electricity Price data for `n`th Zone for the year `yyyy`
|
├──electricityPrices/
|       └──`yyyy-mm-dd`.json       : Electricity Prices for the day `dd` of month `mm` of year `yyyy`
|
├──GraphPlots/
|       ├──MergedPlots/
|       |       └──SE1.png     : Electricity Prices history Graph for all years of SE1
|       |       └──SE2.png     : Electricity Prices history Graph for all years of SE2
|       |       └──SE3.png     : Electricity Prices history Graph for all years of SE3
|       |       └──SE4.png     : Electricity Prices history Graph for all years of SE4
|       |
|       ├──SE1/
|       |       └──`yyyy`.png  : Electricity price history graph for year `yyyy` for SE1 zone of Swedish grid
|       |
|       ├──SE2/
|       |       └──`yyyy`.png  : Electricity price history graph for year `yyyy` for SE2 zone of Swedish grid
|       |
|       ├──SE3/
|       |       └──`yyyy`.png  : Electricity price history graph for year `yyyy` for SE3 zone of Swedish grid
|       |
|       ├──SE4/
|       |       └──`yyyy`.png  : Electricity price history graph for year `yyyy` for SE4 zone of Swedish grid
|       |
|       └──`X`_actualVsPredicted.png        : Graph for Actual vs Predicted for model `X`. If filename contains `_n` at the end, it refers to `n`th fold
|       └──`X`_residualsDistribution.png    : Graph for Residuals Distribution of model `X`
|       └──`X`_timeSeriesPredictions.png    : Graph for Actual vs Predicted over the entire data for model `X`
|       └──Latest Week Predictions Test.png : Graph generated by [tester.py](./tester.py) when testing for last 7 day values
|
├──ModelLogs/
|       └──`X`TrainingLog.txt      : Training log data for model `X`
|       └──TrainingResults.txt     : Training log data for all models at once
|       └──Tester_logs.txt         : Tester log data for testing last 7 days from dataset
|
├──ResultModels/
|       └──`X`_Model.h5    : Model `X` saved as a h5 file
|       └──`X`_Model.pkl    : Model `X` saved as a binary pickle file
|
├──smhi_data/
|       ├──parameter_`i`
|       |       └──station_`x`-SE3.csv     : All collected weather data for parameter `i` from station `x` within SE3 zone.
|
└──constants.py                : Contains all constant values used throughout the project (filenames, keys, etc)
└──dataMerger.py               : Contains all functions used to merge different datas
└──dataMiner.py                : Contains all functions used to mine and gather different datas
└──dataVisualisation.py        : Contains all functions related to visualisation and plotting
└──modelFunctions.py           : Contains all functions related to model creation and training flow
└──tester.py                   : Contains code to test the resultant model on unseen data
└──trainer.py                  : Contains all parameters used for models and functions related to training invokation
|
└──Data_preparing.ipynb        : Jupyter notebook to Prepare data
└──Electricity_plot.ipynb      : Jupyter notebook to plot electricity prices
└──get_smhi_data_.ipynb        : Jupyter notebook to get SMHI weather data
└──Price_analysis.ipynb        : Jupyter notebook to analyze prices
|
└──Merged_Data.csv             : Finalized data merged from all mined and recieved files
'''</code><pre>